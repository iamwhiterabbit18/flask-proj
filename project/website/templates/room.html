{% extends "base.html" %}
{% block title %} Room {% endblock%}
{% block content %} 
  <div class="container d-flex flex-column align-items-center justify-content-center mt-3">
  <div class="message-box">
    <h4 class="text-center">Chat Room: {{room.room_name}}</h4>
      {# {% if messages %} #}
        <div class="messages" id="messages">
          {# {% for message in messages %} #}
            <div class="col-md-4">
              {# {{message.data}} #}
            </div>
          {# {% endfor %} #}
        </div>
      {# {% endif %} #}
  <div class="inputs">
    <input type="text" rows="3" placeholder="Message" name="message" id="message">
    <button type="button" name="send" id="send-btn" onClick="sendMessage()">
      Send
    </button>
  </div>
    </div>
  </div>
  <script type="text/javascript">
    var socketio = io();

    // When connection is established
    socketio.on('connect', () => {
        console.log('Connected to server!');
    });

    // When receiving messages
    socketio.on('message', (data) => {
        console.log('Received message:', data);
        // Add message to your messages div
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML += `
            <div class="message">
                <strong>${data.user}</strong>: ${data.message}
                <small>${data.timestamp}</small>
            </div>
        `;
    });

    // When user joins/leaves
    socketio.on('status', (data) => {
        console.log('Status update:', data);
    });

// Improved sendMessage function
const sendMessage = () => {
    const messageInput = document.getElementById('message');
    const message = messageInput.value;
    
    console.log('Sending message:', message);
    
    socketio.emit('message', {
        room: "{{room.id}}", // Make sure to pass the correct room ID
        message: message
    });
    
    messageInput.value = ''; // Clear input after sending
};

// When joining room
socketio.emit("join", {
    room: "{{ room.id }}",
    user: "{{ user.first_name }}" 
});

  </script>
{% endblock %}